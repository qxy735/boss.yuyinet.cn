<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>禹译后台管理系统</title>
    <link href="<?php echo $this->url->getStatic('assets'); ?>/css/style.css" rel="stylesheet" type="text/css" />
    <link href="<?php echo $this->url->getStatic('assets'); ?>/ueditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
</head>
<body>
<div class="place">
    <span>位置：</span>
    <ul class="placeul">
        <li><a href="<?php echo $this->url->get('/'); ?>" target="_parent">首页</a></li>
        <li><?php if ($navTopMenu) { ?><?php echo $navTopMenu['name']; ?><?php } else { ?>幽灵菜单<?php } ?></li>
        <?php if ($navSonMenu) { ?>
        <li><a href="<?php echo $navSonMenu['url']; ?><?php echo $cond; ?>"><?php echo $navSonMenu['name']; ?></a></li>
        <?php } else { ?>
        <li>幽灵菜单</a></li>
        <?php } ?>
        <li><a href="<?php echo $this->url->get('home/notice'); ?><?php echo $cond; ?>">我的收信箱</a></li>
    </ul>
    <ul class="operator">
        <?php if ($isSendBut) { ?><li class="click"><span><img src="<?php echo $this->url->getStatic('assets'); ?>/images/t02.png" /></span><a href="<?php echo $this->url->get('/home/msg'); ?><?php echo $cond; ?>">发消息</a></li><?php } ?>
        <li class="click"><span><img src="<?php echo $this->url->getStatic('assets'); ?>/images/t01.png" /></span><a href="<?php echo $this->url->get('/home/sendbox'); ?>/navid/<?php echo $navId; ?>">发信箱</a></li>
        <?php if ($isBatchDeleteBut) { ?><li id="batchdelbut"><span><img src="<?php echo $this->url->getStatic('assets'); ?>/images/t03.png" /></span>批量删除</li><?php } ?>
    </ul>
</div>
<div class="rightinfo">
    <div class="tools">
        <form action="<?php echo $this->url->get('home/notice'); ?>" method="post">
            <ul class="search">
                <li><label for="title">标题</label><b>:</b><input type="text" value="<?php echo $title; ?>" name="title" id="title" style="width: 80px;"/></li>
                <li><label for="sendname">发信人</label><b>:</b><input type="text" value="<?php echo $sendName; ?>" name="sendname" id="sendname" style="width: 50px;"/></li>
                <!--<li><label for="starttime">开始时间</label><b>:</b><input type="text" value="<?php echo $startTime; ?>" name="starttime" id="starttime" style="width: 65px;"/></li>
                <li><label for="endtime">结束时间</label><b>:</b><input type="text" value="<?php echo $endTime; ?>" name="endtime" id="endtime" style="width: 65px;"/></li>-->
                <li><label for="typeid">消息类型</label><b>:</b>
                    <select id="typeid" name="typeid">
                        <option value="-1">全部</option>
                        <?php foreach ($msgTypes as $aMsgType) { ?>
                        <option value="<?php echo $aMsgType['id']; ?>" <?php if ($aMsgType['id'] == $typeId) { ?>selected="selected"<?php } ?>><?php echo $aMsgType['name']; ?></option>
                        <?php } ?>
                    </select>
                </li>
                <li><label for="msgtype">消息来源</label><b>:</b>
                    <select id="msgtype" name="msgtype">
                        <option value="-1">全部</option>
                        <?php foreach ($sources as $index => $source) { ?>
                        <option value="<?php echo $index; ?>" <?php if ($index == $msgType) { ?>selected="selected"<?php } ?>><?php echo $source; ?></option>
                        <?php } ?>
                    </select>
                </li>
                <li><label for="isfriend">好友信息</label><b>:</b>
                    <select id="isfriend" name="isfriend">
                        <option value="-1">全部</option>
                        <?php foreach ($isFriends as $index => $isFriendValue) { ?>
                        <option value="<?php echo $index; ?>" <?php if ($index == $isFriend) { ?>selected="selected"<?php } ?>><?php echo $isFriendValue; ?></option>
                        <?php } ?>
                    </select>
                </li>
                <li><input type="hidden" name="navid" value="<?php echo $navId; ?>"/><input type="submit" value="搜索" id="formbut" class="search-but"/></li>
            </ul>
        </form>
    </div>
    <table class="tablelist">
        <thead>
        <tr>
            <th><input name="" type="checkbox" value="" class="checkbut"/></th>
            <th>序号</th>
            <th>ID</th>
            <th>发信人</th>
            <th>标题</th>
            <th>内容</th>
            <th>类型</th>
            <th>来源</th>
            <th>已阅</th>
            <th>好友信息</th>
            <th>发送时间</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <?php foreach ($messages as $index => $message) { ?>
        <tr>
            <td><input name="checkinput" type="checkbox"  class="checkinput" value="<?php echo $message['id']; ?>" /></td>
            <td><?php echo $index + 1; ?></td>
            <td><?php echo $message['id']; ?></td>
            <td><?php echo $message['msg']['sendname']; ?></td>
            <td><?php echo $message['msg']['shorttitle']; ?></td>
            <td><a href="#" class="contbut tablelink" index="<?php echo $index; ?>">查看</a></td>
            <td><?php echo $message['msg']['typeid']; ?></td>
            <td><?php echo $message['msg']['msgtype']; ?></td>
            <td><?php echo $message['isreadname']; ?></td>
            <td><?php echo $message['msg']['isfriend']; ?></td>
            <td><?php echo $message['msg']['sendtime']; ?></td>
            <td><?php if ((!$message['isread'] && $isSetBut)) { ?><a href="<?php echo $this->url->get('/home/read'); ?><?php echo $cond; ?>/page/<?php echo $page['page']; ?>/id/<?php echo $message['id']; ?>" class="tablelink">已阅</a>|<?php } ?>
                <?php if ($isDeleteBut) { ?><a href="<?php echo $this->url->get('/home/delnotice'); ?><?php echo $cond; ?>/id/<?php echo $message['id']; ?>" class="tablelink"> 删除</a><?php } ?></td>
        </tr>
        <div class="tip conts">
            <div class="tiptop"><span>标题 : <?php echo $message['msg']['title']; ?></span><a class="close"></a></div>
            <div class="tipinfo notice-content" style="margin: 0;padding: 10px;overflow-y: scroll;height: 195px;">
                    <?php echo $message['msg']['content']; ?>
            </div>
        </div>
        <?php } ?>
        </tbody>
    </table>
    <div class="pagin">
        <?php if ($page['num']) { ?>
        <div class="message">共<i class="blue"><?php echo $page['total']; ?></i>条记录，当前显示第&nbsp;<i class="blue"><?php echo $page['page']; ?>&nbsp;</i>页</div>
        <ul class="paginList">
            <li class="paginItem"><a href="<?php echo $this->url->get('/home/notice/page/'); ?><?php echo $page['before']; ?><?php echo $cond; ?>"><span class="pagepre"></span></a></li>
            <?php foreach (range(1, $page['num']) as $index) { ?>
            <?php if ($page['page'] == $index) { ?>
            <li class="paginItem current"><a href="<?php echo $this->url->get('/home/notice/page/'); ?><?php echo $index; ?><?php echo $cond; ?>"><?php echo $index; ?></a></li>
            <?php } else { ?>
            <li class="paginItem"><a href="<?php echo $this->url->get('/home/notice/page/'); ?><?php echo $index; ?><?php echo $cond; ?>"><?php echo $index; ?></a></li>
            <?php } ?>
            <?php } ?>
            <li class="paginItem"><a href="<?php echo $this->url->get('/home/notice/page/'); ?><?php echo $page['next']; ?><?php echo $cond; ?>"><span class="pagenxt"></span></a></li>
        </ul>
        <?php } else { ?>
        <p align="center">暂无记录...</p>
        <?php } ?>
    </div>
</div>
<script type="text/javascript" src="<?php echo $this->url->getStatic('assets'); ?>/js/jquery.js"></script>
<!--<script type="text/javascript" src="<?php echo $this->url->getStatic('assets'); ?>/js/jquery.date.js"></script>-->
<script type="text/javascript">
    $(function(){
        $('.tablelist tbody tr:odd').addClass('odd');
        /*$('#starttime').date_input();
        $('#endtime').date_input();
        $('#formbut').click(function(){
            var stime = $('#starttime').val();
            var etime = $('#endtime').val();
            if( stime && etime){
                stime = Date.parse(new Date(stime)) / 1000;
                etime = Date.parse(new Date(etime)) / 1000;
                if(stime > etime){
                    alert('结束时间必须大于开始时间');
                    return false;
                }
            }
            return true;
        });*/

        $('.checkbut').click(function(){
            $('.checkinput').attr("checked",$(this).is(':checked'));
        });

        $('#batchdelbut').click(function(){
            var ids = '';

            $(".checkinput:checked").each(function(i, n){
                ids += $(this).val() + ',';
            });

            if(!ids){
                alert('请先选择需要删除的消息!');
            }else{
                location.href = '/home/delnotice/<?php echo $cond; ?>/id/' + ids;
            }
        })

        $('.contbut').each(function(){
            $(this).click(function(){
                var i = $(this).attr('index');

                $('.conts').eq(i).fadeIn(200);
            });
        });

        $('.close').click(function(){
            $('.conts').fadeOut(200);
        });
    });
</script>
<script type="text/javascript">
    var links = document.links;

    for(var i= 0,l=links.length; i < l; i++){
        links[i].onclick = function(){
            if(-1 == document.cookie.indexOf('admin_user=')){
                parent.location.href = '/auth/login';

                return false;
            }

            return true;
        }
    }
</script>
</body>
</html>